{
  "id": "experiment:sub-resources",
  "description": "Users can have devices, but the devices are their own resources.",
  "definitions": {
    "user": {
      "title": "User",
      "description": "User with device sub-resources",
      "type": "object",
      "required": [
        "_id",
        "displayName"
      ],
      "properties": {
        "_id": {
          "type": "string",
          "title": "Unique Identifier",
          "writePolicy": "WRITE_ON_CREATE",
          "errorOnWritePolicyFailure": true
        },
        "_rev": {
          "type": "string",
          "title": "Revision Identifier",
          "readOnly": "true"
        },
        "displayName": {
          "type": "string",
          "title": "Name",
          "description": "Name for this group"
        },
        "devices": {
          "type": "array",
          "title": "Devices",
          "description": "Devices belonging to this user",
          "items": {
            "$ref": "#/definitions/device"
          },
          "readOnly": true,
          "uniqueItems": true
        }
      }
    },
    "device": {
      "title": "Device",
      "description": "Device",
      "type": "object",
      "properties": {
        "_id": {
          "type": "string",
          "title": "Unique Identifier",
          "writePolicy": "WRITE_ON_CREATE",
          "errorOnWritePolicyFailure": true
        },
        "_rev": {
          "type": "string",
          "title": "Revision Identifier",
          "readOnly": "true"
        },
        "description": {
          "type": "string",
          "title": "Description"
        }
      }
    }
  },
  "services": [
    {
      "id": "users",
      "resourceSchema": {
        "$ref": "#/definitions/user"
      },
      "create": {
        "mode": "ID_FROM_SERVER",
        "mvccSupported": true
      },
      "queries": [
        {
          "type": "FILTER",
          "queryableFields": [
            "_id",
            "displayName"
          ],
          "pagingMode": [
            "COOKIE",
            "OFFSET"
          ],
          "supportedPagingCountPolicies": [
            "NONE"
          ],
          "description": "Return resources matching the filter. TODO get explanation of query filters from Javadoc."
        }
      ],
      "sub": {
        "/{id}": {
          "$ref": "#/services/user"
        }
      }
    },
    {
      "id": "user",
      "resourceSchema": {
        "$ref": "#/definitions/user"
      },
      "create": {
        "mode": "ID_FROM_CLIENT",
        "mvccSupported": true
      },
      "read": {},
      "update": {
        "mvccSupported": true
      },
      "delete": {
        "mvccSupported": true
      },
      "patch": {
        "mvccSupported": true
      },
      "sub": {
        "/devices": {
          "$ref": "#/services/devices"
        }
      }
    },
    {
      "id": "devices",
      "resourceSchema": {
        "$ref": "#/definitions/device"
      },
      "create": {
        "mode": "ID_FROM_SERVER",
        "mvccSupported": true
      },
      "queries": [
        {
          "type": "FILTER",
          "queryableFields": [
            "_id",
            "description"
          ],
          "pagingMode": [
            "COOKIE",
            "OFFSET"
          ],
          "supportedPagingCountPolicies": [
            "NONE"
          ],
          "description": "Return resources matching the filter. TODO get explanation of query filters from Javadoc."
        }
      ],
      "sub": {
        "/{id}": {
          "$ref": "#/services/device"
        }
      }
    },
    {
      "id": "device",
      "resourceSchema": {
        "$ref": "#/definitions/device"
      },
      "create": {
        "mode": "ID_FROM_CLIENT",
        "mvccSupported": true
      },
      "read": {},
      "update": {
        "mvccSupported": true
      },
      "delete": {
        "mvccSupported": true
      },
      "patch": {
        "mvccSupported": true
      }
    }
  ],
  "paths": {
    "/users": {
      "$ref": "#/services/users"
    },
    "/devices": {
      "$ref": "#/services/devices"
    }
  }
}
